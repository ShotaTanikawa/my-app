# V1.1ロードマップ

最終更新日: 2026-02-16

## 目的

- V1（MVP）を壊さずに、運用時の可観測性と監査性を高める。

## 実施項目

### 1. 監査ログ検索・ページング（完了）

- Backend:
  - `GET /api/audit-logs` に `page`, `size`, `action`, `actor`, `from`, `to` を追加
  - レスポンスをページング形式（`items`, `totalElements`, `totalPages` など）へ拡張
- Frontend:
  - 監査ログ画面に操作種別/ユーザーのフィルタ追加
  - 前へ/次へボタンによるページング追加
- Test:
  - 監査ログ統合テストをページング形式に更新
  - 操作種別フィルタの検証を追加

### 2. 監査ログCSVエクスポート（完了）

- Backend:
  - `GET /api/audit-logs/export.csv` を追加
  - `action`, `actor`, `from`, `to`, `limit` 条件でCSVを出力
- Frontend:
  - 監査ログ画面にCSV出力ボタンを追加
  - 現在のフィルタ条件を付与してダウンロード

### 3. Refresh Token端末単位失効（完了）

- Backend:
  - `refresh_tokens` に `session_id`, `user_agent`, `ip_address`, `last_used_at`, `revoked_at` を追加
  - `GET /api/auth/sessions` と `DELETE /api/auth/sessions/{sessionId}` を追加
- Frontend:
  - `/sessions` 画面を追加し、セッション一覧と個別失効を実装
- Test:
  - 認証統合テストにセッション一覧/失効の検証を追加

### 4. 監査ログ保持ポリシー（完了）

- Backend:
  - `POST /api/audit-logs/cleanup` を追加（`retentionDays` 指定で手動削除）
  - `jobs.audit-log-retention-*` 設定と定期削除ジョブを追加
- Frontend:
  - 監査ログ画面に保持日数入力と手動クリーンアップボタンを追加
- Test:
  - 監査ログ統合テストに手動クリーンアップ成功/権限拒否ケースを追加

## 次フェーズ（V1.2着手）

### 5. 仕入発注フロー追加（実装済み）

- Backend:
  - `products` に `reorder_point`, `reorder_quantity` を追加
  - `purchase_orders`, `purchase_order_items` を追加
  - `GET /api/purchase-orders/suggestions`（補充提案）
  - `POST /api/purchase-orders`（発注作成）
  - `POST /api/purchase-orders/{id}/receive`（入荷）
  - `POST /api/purchase-orders/{id}/cancel`（キャンセル）
- Frontend:
  - `/purchase-orders`, `/purchase-orders/new`, `/purchase-orders/[id]` を追加
  - 商品画面に再発注点/発注ロットの管理UIを追加
- Test:
  - 仕入発注の作成→入荷フローと権限制御の統合テストを追加
